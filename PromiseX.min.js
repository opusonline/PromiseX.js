/**
 * PromiseX - Promise Xtended
 * wrapper for promises to add new methods w/o changing the native promise prototype
 * good read: http://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html
 * also interesting: https://github.com/paldepind/sync-promise
 * http://exploringjs.com/es6/ch_promises.html
 * @author Stefan Benicke <stefan.benicke@gmail.com>
 * @version 1.2.0
 * @see {@link https://github.com/opusonline/PromiseX.js}
 * @license MIT
 */
!function(n,t){function e(){function s(n,e){if(!(this instanceof s))throw new TypeError("Failed to construct 'PromiseX': Please use the 'new' operator, this object constructor cannot be called as a function.");if(n instanceof s)return n;var r=this;return this.status=s.PENDING,this.value=t,n instanceof h?(this.promise=n.then(function(n){return r.status=s.RESOLVED,r.value=n,n},function(n){throw r.status=s.REJECTED,r.value=n,n}),this):(typeof n===f&&(this.resolve=null,this.reject=null,n=function(n,t,e){e.resolve=function(t){return n(t),e},e.reject=function(n){return t(n),e}}),typeof n===c?(typeof e===f&&(e=r),this.promise=new h(function(t,o){try{n.call(e,function(n){r.status===s.PENDING&&(r.status=s.RESOLVED,r.value=n,t(n))},function(n){r.status===s.PENDING&&(r.status=s.REJECTED,r.value=n,o(n))},r)}catch(i){r.status===s.PENDING&&(r.status=s.REJECTED,r.value=i,o(i))}}),this):(this.promise=a(n),this.status=s.RESOLVED,void(this.value=n)))}function a(n){return n instanceof h?n:h.resolve(n)}function l(n){typeof n===f&&(n=h);try{var t=new n(function(n,t){});return"then"in t&&typeof t.then===c}catch(e){}return!1}var h=n.Promise;s.PENDING="pending",s.RESOLVED="resolved",s.REJECTED="rejected";var p=s.prototype;return u(p,"status",s.PENDING),u(p,"value",t),u(p,"then",function(n,t,e){var r;if(typeof e!==f){var o=typeof n!==c?n:function(t){return n.call(e,t)},i=typeof t!==c?t:function(n){return t.call(e,n)};r=this.promise.then(o,i)}else r=this.promise.then(n,t);return new s(r)}),u(p,"catch",function(n,t){var e;if(typeof t!==f){var r=typeof n!==c?n:function(e){return n.call(t,e)};e=this.promise["catch"](r)}else e=this.promise["catch"](n);return new s(e)}),u(p,"finally",function(n,t){var e=this.promise.then(function(e){return a(n.call(t)).then(function(n){return typeof n!==f?n:e})},function(e){return a(n.call(t)).then(function(n){if(typeof n!==f)return n;throw e})});return new s(e)}),u(p,"done",function(n,t,e){this.then(n,t,e)["catch"](function(n){i(function(){throw n})})}),u(p,"nodeify",function(n,t){return typeof n!==c?this:(this.promise.then(function(e){i(function(){n.call(t,null,e)})},function(e){i(function(){n.call(t,e)})}),this)}),u(p,"delay",function(n){var t=this.promise.then(function(t){return new h(function(e){setTimeout(function(){e(t)},n)})},function(t){return new h(function(e,r){setTimeout(function(){r(t)},n)})});return new s(t)}),u(s,"resolve",function(n){return n instanceof s?n:new s(function(t){t(n)})}),u(s,"reject",function(n){return new s(function(t,e){e(n)})}),u(s,"timeout",function(n,t,e){return new s(function(r,o){setTimeout(function(){o(new Error(e||"Timeout"))},t),n.then(r,o)})}),u(s,"delay",function(n,t){return new s(function(e){setTimeout(function(){e(t)},n)})}),u(s,"defer",function(){return new s}),u(s,"cast",function(n){return n instanceof s?n:new s(n)}),u(s,"all",function(n){return new s(function(t,e){h.all(n).then(t,e)})}),u(s,"race",function(n){return new s(function(t,e){if(typeof n===f||null===n)throw new TypeError("First argument needs to be an array of promises.");if(o(n)){var r,i=n.length;if(0===i)return t();for(r=0;i>r;r++)a(n[r]).then(t,e)}else t(n)})}),u(s,"every",function(n){return new s(function(t){if(typeof n===f||null===n)throw new TypeError("First argument needs to be an array of promises.");o(n)===!1&&(n=[n]);var e=n.length,i=new Array(e);if(0===e)return t(i);var u=function(){e--,0===e&&t(i)};r(n,function(n,t){n=s.cast(n);var e=function(){i[t]=n,u()};n.then(e,e)})})}),u(s,"any",function(n){return new s(function(t,e){if(typeof n===f||null===n)throw new TypeError("First argument needs to be an array of promises.");if(o(n)){var r=!1,i=n.length;if(0===i)return t();var u,c,s=function(n){r=!0,i--,t(n)},l=function(){i--,0!==i||r||e(new Error("No promises resolved successfully."))};for(u=0,c=i;c>u;u++)a(n[u]).then(s,l)}else t(n)})}),u(s,"map",function(n,t,e){if(typeof t!==c)throw new TypeError("Map-function is no valid function");o(n)===!1&&(n=[n]);var r,i=[],u=n.length;for(r=0;u>r;r++)i.push(s.cast(t.call(e,n[r],r,u,n)));return i}),u(s,"config",function(n,t){if("getPromise"===n)return h;if("setPromise"===n&&typeof t!==f){if(l(t)===!1)throw new TypeError(" Invalid Promise: "+t.toString());return h=t,!0}if("createPromise"===n&&typeof t!==f){if(l(t)===!1)throw new TypeError(" Invalid Promise: "+t.toString());var r=e();return r.config("setPromise",t),r}return!1}),s}function r(n,t,e){if(o(n)===!1&&(n=[n]),Array.prototype.forEach)return n.forEach(t,e);var r,i;for(r=0,i=n.length;i>r;r++)t.call(e,n[r],r,n)}function o(n){return Array.isArray?Array.isArray(n):"[object Array]"===Object.prototype.toString.call(n)}var i=n.setImmediate||function(n){return setTimeout(n,0)},u=function(){try{return Object.defineProperty({},"x",{}),function(n,t,e){return Object.defineProperty(n,t,{value:e,writable:!0,enumerable:!1,configurable:!0})}}catch(n){}return function(n,t,e){return n[t]=e,n}}(),f="undefined",c="function",s=e();typeof define===c&&define.amd?define(function(){return s}):typeof module!==f?module.exports=s:n.PromiseX=s}(this);